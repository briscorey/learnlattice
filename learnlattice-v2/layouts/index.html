{{ define "main" }}
{{ $featuredSubjects := .Site.Params.featured_subjects }}
{{ $home := .Site.Params.home }}
{{ $subjectLookup := newScratch }}
{{ range $featuredSubjects }}
  {{ $subjectLookup.Set (lower .title) . }}
{{ end }}

<!-- HERO -->
<section class="hero">
  <div class="hero-layout">
    <div class="hero-copy">
      <div class="hero-eyebrow">{{ $home.hero_eyebrow }}</div>
      <h1>{{ $home.hero_title | safeHTML }}</h1>
      <p>{{ .Site.Params.description }}</p>
      <div class="hero-actions">
        <a href="{{ $home.hero_primary_url }}" class="btn-primary">
          {{ $home.hero_primary_label }}
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
        </a>
        <a href="{{ $home.hero_secondary_url }}" class="btn-secondary">{{ $home.hero_secondary_label }}</a>
      </div>
    </div>

    <div class="hero-visual">
      <a class="hero-video-card" href="{{ $home.subjects_link_url }}">
        <div class="hero-video-label">{{ $home.hero_media_label }}</div>
        <img src="{{ $home.hero_panel_image }}" alt="Illustrated preview reel spanning multiple LearnLattice topics">
        <div class="hero-video-copy">
          <span class="hero-video-kicker">{{ $home.hero_kicker }}</span>
          <h2>{{ $home.hero_panel_title }}</h2>
          <p>{{ $home.hero_panel_copy }}</p>
          <span class="hero-video-cta">Browse subject pathways</span>
        </div>
      </a>
    </div>
  </div>
</section>

<!-- STATS -->
<div class="stats reveal">
  <div class="stat">
    <span class="stat-num">{{ len (where .Site.RegularPages "Section" "resources") }}+</span>
    <span class="stat-label">Downloadable<br>resources</span>
  </div>
  <div class="stat-divider"></div>
  <div class="stat">
    <span class="stat-num">{{ len $featuredSubjects }}</span>
    <span class="stat-label">Subject<br>areas</span>
  </div>
  <div class="stat-divider"></div>
  <div class="stat">
    <span class="stat-num">MYP</span>
    <span class="stat-label">Framework<br>aligned</span>
  </div>
</div>

<!-- SUBJECTS -->
<section class="section reveal">
  <div class="section-header">
    <div>
      <h2 class="section-title">{{ $home.subjects_title }}</h2>
      <p class="section-subtitle">{{ $home.subjects_subtitle }}</p>
    </div>
    <a href="{{ $home.subjects_link_url }}" class="section-link">
      {{ $home.subjects_link_label }}
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
    </a>
  </div>

  <div class="subjects-grid">
    {{ range $featuredSubjects }}
      {{ $resourceCount := len (where (where $.Site.RegularPages "Section" "resources") "Params.subjects" "intersect" (slice .title)) }}
      {{ $subjectTitle := .title }}
      <a class="subject-card" data-color="{{ .color }}" href="{{ .url }}">
        <div class="subject-media">
          {{ if .image }}
          <img src="{{ .image }}" alt="{{ $subjectTitle }} subject artwork">
          {{ end }}
        </div>
        <div class="subject-body">
          <div class="subject-meta">
            <div class="subject-icon">{{ .icon }}</div>
            <span class="subject-audience">{{ $resourceCount }} {{ if eq $resourceCount 1 }}resource{{ else }}resources{{ end }}</span>
          </div>
          <h3>{{ .title }}</h3>
          <p>{{ .description }}</p>
          <div class="subject-footer">
            <div class="subject-count">{{ .audience }}</div>
            <span class="subject-cta">Open {{ .title }}</span>
          </div>
        </div>
      </a>
    {{ end }}
  </div>
</section>

<!-- QUICK START -->
<section class="section reveal">
  <div class="section-header">
    <div>
      <h2 class="section-title">Start Here</h2>
      <p class="section-subtitle">Three quick routes into the library, depending on how you like to plan.</p>
    </div>
  </div>
  <div class="quick-start-grid">
    <a class="quick-start-card" href="/resources/">
      <span class="quick-start-label">Browse the whole collection</span>
      <h3>See every resource in one place</h3>
      <p>Best for teachers who already know the unit or skill they want to target.</p>
    </a>
    <a class="quick-start-card" href="/subjects/biology/">
      <span class="quick-start-label">Browse by subject</span>
      <h3>Jump straight into a content area</h3>
      <p>Use the subject pages when you want the fastest route into biology, ecology, space science, and more.</p>
    </a>
    <a class="quick-start-card" href="/#topic-pathways">
      <span class="quick-start-label">Browse by concept</span>
      <h3>Follow topic pathways and tags</h3>
      <p>Useful when you are planning around a theme, concept, or inquiry question instead of a single worksheet.</p>
    </a>
  </div>
</section>

<!-- LATEST RESOURCES -->
{{ $resources := where .Site.RegularPages "Section" "resources" }}
{{ if $resources }}
<section class="section reveal">
  <div class="section-header">
    <h2 class="section-title">{{ $home.latest_title }}</h2>
    <a href="{{ $home.latest_link_url }}" class="section-link">
      {{ $home.latest_link_label }}
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
    </a>
  </div>

  <div class="resources-grid">
    {{ range first 6 $resources }}
      {{ partial "resource-card.html" . }}
    {{ end }}
  </div>
</section>
{{ end }}

<!-- POPULAR TOPICS -->
{{ if .Site.Taxonomies.tags }}
<section class="section reveal" id="popular-topics">
  <div class="section-header">
    <h2 class="section-title">{{ $home.topics_title }}</h2>
  </div>
  <div class="topics-wrap">
    {{ range .Site.Taxonomies.tags.ByCount }}
      <a class="topic-pill" href="{{ .Page.RelPermalink }}">
        {{ .Page.Title }} <span class="count">{{ .Count }}</span>
      </a>
    {{ end }}
  </div>
</section>
{{ end }}

<!-- TOPIC PATHWAYS -->
<div id="topic-pathways">
{{ partial "topic-pathways.html" (dict
  "page" .
  "showAll" true
  "headline" $home.pathways_title
  "copy" $home.pathways_copy
) }}
</div>

<!-- FEATURED BANNER -->
<div class="featured-banner reveal">
  <div class="featured-inner">
    <div class="featured-text">
      <h2>{{ $home.featured_title }}</h2>
      <p>{{ $home.featured_copy }}</p>
    </div>
    <a href="{{ $home.featured_link_url }}" class="btn-amber">{{ $home.featured_link_label }}</a>
  </div>
</div>

{{ end }}
