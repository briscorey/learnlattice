{{ define "main" }}
{{ $home := .Site.Params.home }}
{{ $resources := where .Site.RegularPages "Section" "resources" }}
{{ $mathLinks := slice
  (dict "title" "All MYP Mathematics" "url" "/subjects/mathematics/" "copy" "Browse the full MYP mathematics collection.")
  (dict "title" "Algebra" "url" "/tags/algebra/" "copy" "Patterns, equations, and linear relationships.")
  (dict "title" "Criterion D" "url" "/tags/criterion-d/" "copy" "Real-world mathematical application tasks.")
}}
{{ $scienceLinks := slice
  (dict "title" "All MYP Science" "url" "/subjects/science/" "copy" "Browse the full MYP science collection.")
  (dict "title" "Biology" "url" "/subjects/biology/" "copy" "Cells, systems, and living processes.")
  (dict "title" "Ecology" "url" "/subjects/ecology/" "copy" "Ecosystems, biodiversity, and fieldwork.")
  (dict "title" "Space Science" "url" "/subjects/space-science/" "copy" "Astronomy, models, and planetary systems.")
  (dict "title" "Earth Science" "url" "/subjects/earth-science/" "copy" "Tectonics, earthquakes, and Earth systems.")
  (dict "title" "Chemistry" "url" "/subjects/chemistry/" "copy" "Particles, mixtures, and reactions.")
}}
{{ $gradeLinks := slice
  (dict "title" "BC Grade 6" "url" "/year-levels/bc-grade-6/")
  (dict "title" "BC Grade 7" "url" "/year-levels/bc-grade-7/")
  (dict "title" "BC Grade 8" "url" "/year-levels/bc-grade-8/")
  (dict "title" "BC Grade 9" "url" "/year-levels/bc-grade-9/")
}}
{{ $browseLinks := slice
  (dict "title" "All Resources" "url" "/resources/" "copy" "Open the full resource library.")
  (dict "title" "Unit Plans" "url" "/resource-types/unit-plan/" "copy" "Longer inquiry sequences and full units.")
  (dict "title" "Worksheets" "url" "/resource-types/worksheet/" "copy" "Structured practice and reflection.")
  (dict "title" "Lab Activities" "url" "/resource-types/lab-activity/" "copy" "Practical investigations and experiments.")
  (dict "title" "Investigation Packs" "url" "/resource-types/investigation-pack/" "copy" "Guided inquiry packs and evidence tasks.")
  (dict "title" "Topic Pathways" "url" "/#topic-pathways" "copy" "Browse by concept instead of by subject.")
}}
{{ $startLinks := slice
  (dict "title" "MYP Mathematics" "url" "/subjects/mathematics/")
  (dict "title" "MYP Science" "url" "/subjects/science/")
  (dict "title" "BC Curriculum" "url" "/year-levels/")
  (dict "title" "All Resources" "url" "/resources/")
}}

<section class="ka-home-hero">
  <div class="ka-home-shell">
    <div class="ka-home-copy">
      <div class="hero-eyebrow">{{ $home.hero_eyebrow }}</div>
      <h1>{{ $home.hero_title }}</h1>
      <p>{{ .Site.Params.description }}</p>
      <div class="hero-actions">
        <a href="{{ $home.hero_primary_url }}" class="btn-primary">{{ $home.hero_primary_label }}</a>
        <a href="{{ $home.hero_secondary_url }}" class="btn-secondary">{{ $home.hero_secondary_label }}</a>
      </div>
    </div>

    <aside class="ka-start-panel">
      <h2>{{ $home.hero_panel_title }}</h2>
      <p>{{ $home.hero_panel_copy }}</p>
      <div class="ka-start-links">
        {{ range $startLinks }}
        <a class="ka-start-link" href="{{ .url }}">
          <span>{{ .title }}</span>
          <span>â†’</span>
        </a>
        {{ end }}
      </div>
    </aside>
  </div>
</section>

<div class="stats reveal">
  <div class="stat">
    <span class="stat-num">{{ len $resources }}+</span>
    <span class="stat-label">Downloadable<br>resources</span>
  </div>
  <div class="stat-divider"></div>
  <div class="stat">
    <span class="stat-num">6</span>
    <span class="stat-label">MYP subject<br>branches</span>
  </div>
  <div class="stat-divider"></div>
  <div class="stat">
    <span class="stat-num">4</span>
    <span class="stat-label">BC grade<br>collections</span>
  </div>
</div>

<section class="section reveal">
  <div class="section-header">
    <div>
      <h2 class="section-title">{{ $home.programs_title }}</h2>
      <p class="section-subtitle">{{ $home.programs_subtitle }}</p>
    </div>
  </div>

  <div class="ka-program-grid">
    <article class="ka-program-card">
      <div class="ka-program-top">
        <span class="ka-program-kicker">MYP</span>
        <h3>{{ $home.myp_math_title }}</h3>
        <p>{{ $home.myp_math_subtitle }}</p>
      </div>
      <div class="ka-link-list">
        {{ range $mathLinks }}
        <a class="ka-list-link" href="{{ .url }}">
          <span>{{ .title }}</span>
          <small>{{ .copy }}</small>
        </a>
        {{ end }}
      </div>
    </article>

    <article class="ka-program-card">
      <div class="ka-program-top">
        <span class="ka-program-kicker">MYP</span>
        <h3>{{ $home.myp_science_title }}</h3>
        <p>{{ $home.myp_science_subtitle }}</p>
      </div>
      <div class="ka-link-list">
        {{ range $scienceLinks }}
        <a class="ka-list-link" href="{{ .url }}">
          <span>{{ .title }}</span>
          <small>{{ .copy }}</small>
        </a>
        {{ end }}
      </div>
    </article>

    <article class="ka-program-card">
      <div class="ka-program-top">
        <span class="ka-program-kicker">BC</span>
        <h3>{{ $home.grades_title }}</h3>
        <p>{{ $home.grades_subtitle }}</p>
      </div>
      <div class="ka-link-list">
        {{ range $gradeLinks }}
        {{ $count := len (where $resources "Params.year_levels" "intersect" (slice .title)) }}
        <a class="ka-list-link" href="{{ .url }}">
          <span>{{ .title }}</span>
          <small>{{ $count }} resources</small>
        </a>
        {{ end }}
      </div>
    </article>
  </div>
</section>

<section class="section reveal">
  <div class="section-header">
    <div>
      <h2 class="section-title">{{ $home.browse_title }}</h2>
      <p class="section-subtitle">{{ $home.browse_subtitle }}</p>
    </div>
  </div>
  <div class="ka-compact-grid">
    {{ range $browseLinks }}
    <a class="simple-link-card" href="{{ .url }}">
      <h3>{{ .title }}</h3>
      <p>{{ .copy }}</p>
    </a>
    {{ end }}
  </div>
</section>

{{ if $resources }}
<section class="section reveal">
  <div class="section-header">
    <h2 class="section-title">{{ $home.latest_title }}</h2>
    <a href="{{ $home.latest_link_url }}" class="section-link">
      {{ $home.latest_link_label }}
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
    </a>
  </div>
  <div class="resource-list resource-list-home">
    {{ range first 6 $resources }}
      {{ $subject := "" }}
      {{ with .Params.subjects }}{{ $subject = index . 0 }}{{ end }}
      {{ $resourceType := "" }}
      {{ with .Params.resource_types }}{{ $resourceType = index . 0 }}{{ end }}
      <a class="resource-list-item" href="{{ .RelPermalink }}">
        <div class="resource-list-main">
          <div class="resource-list-top">
            {{ with $subject }}<span class="resource-list-label">{{ . }}</span>{{ end }}
            {{ with $resourceType }}<span class="resource-list-type">{{ . }}</span>{{ end }}
          </div>
          <h2>{{ .Title }}</h2>
          <p>{{ .Description | default .Summary }}</p>
        </div>
        <div class="resource-list-meta">
          {{ range first 2 .Params.year_levels }}
            <span class="resource-tag">{{ . }}</span>
          {{ end }}
          {{ range first 2 .Params.tags }}
            <span class="resource-tag">{{ . }}</span>
          {{ end }}
        </div>
      </a>
    {{ end }}
  </div>
</section>
{{ end }}

{{ if .Site.Taxonomies.tags }}
<section class="section reveal" id="popular-topics">
  <div class="section-header">
    <h2 class="section-title">{{ $home.topics_title }}</h2>
  </div>
  <div class="topics-wrap">
    {{ range first 18 .Site.Taxonomies.tags.ByCount }}
      <a class="topic-pill" href="{{ .Page.RelPermalink }}">
        {{ .Page.Title }} <span class="count">{{ .Count }}</span>
      </a>
    {{ end }}
  </div>
</section>
{{ end }}

{{ end }}
