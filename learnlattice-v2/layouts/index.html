{{ define "main" }}
{{ $featuredSubjects := .Site.Params.featured_subjects }}
{{ $home := .Site.Params.home }}

<!-- HERO -->
<section class="hero">
  <div class="hero-eyebrow">{{ $home.hero_eyebrow }}</div>
  <h1>{{ $home.hero_title | safeHTML }}</h1>
  <p>{{ .Site.Params.description }}</p>
  <div class="hero-actions">
    <a href="{{ $home.hero_primary_url }}" class="btn-primary">
      {{ $home.hero_primary_label }}
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
    </a>
    <a href="{{ $home.hero_secondary_url }}" class="btn-secondary">{{ $home.hero_secondary_label }}</a>
  </div>
</section>

<!-- STATS -->
<div class="stats">
  <div class="stat">
    <span class="stat-num">{{ len (where .Site.RegularPages "Section" "resources") }}+</span>
    <span class="stat-label">Downloadable<br>resources</span>
  </div>
  <div class="stat-divider"></div>
  <div class="stat">
    <span class="stat-num">{{ len $featuredSubjects }}</span>
    <span class="stat-label">Subject<br>areas</span>
  </div>
  <div class="stat-divider"></div>
  <div class="stat">
    <span class="stat-num">MYP</span>
    <span class="stat-label">Framework<br>aligned</span>
  </div>
</div>

<!-- SUBJECTS -->
<section class="section reveal">
  <div class="section-header">
    <div>
      <h2 class="section-title">{{ $home.subjects_title }}</h2>
      <p class="section-subtitle">{{ $home.subjects_subtitle }}</p>
    </div>
    <a href="{{ $home.subjects_link_url }}" class="section-link">
      {{ $home.subjects_link_label }}
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
    </a>
  </div>

  <div class="subjects-grid">
    {{ range $featuredSubjects }}
      {{ $subjectPages := index $.Site.Taxonomies.subjects .key }}
      {{ $resourceCount := len $subjectPages }}
      <a class="subject-card" data-color="{{ .color }}" href="{{ .url }}">
        <div class="subject-icon">{{ .icon }}</div>
        <h3>{{ .title }}</h3>
        <p>{{ .description }}</p>
        <div class="subject-count">{{ $resourceCount }} {{ if eq $resourceCount 1 }}resource{{ else }}resources{{ end }}</div>
      </a>
    {{ end }}
  </div>
</section>

<!-- LATEST RESOURCES -->
{{ $resources := where .Site.RegularPages "Section" "resources" }}
{{ if $resources }}
<section class="section reveal">
  <div class="section-header">
    <h2 class="section-title">{{ $home.latest_title }}</h2>
    <a href="{{ $home.latest_link_url }}" class="section-link">
      {{ $home.latest_link_label }}
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
    </a>
  </div>

  <div class="resources-grid">
    {{ range first 6 $resources }}
      {{ partial "resource-card.html" . }}
    {{ end }}
  </div>
</section>
{{ end }}

<!-- POPULAR TOPICS -->
{{ if .Site.Taxonomies.tags }}
<section class="section reveal">
  <div class="section-header">
    <h2 class="section-title">{{ $home.topics_title }}</h2>
  </div>
  <div class="topics-wrap">
    {{ range .Site.Taxonomies.tags.ByCount }}
      <a class="topic-pill" href="{{ .Page.RelPermalink }}">
        {{ .Page.Title }} <span class="count">{{ .Count }}</span>
      </a>
    {{ end }}
  </div>
</section>
{{ end }}

<!-- TOPIC PATHWAYS -->
{{ partial "topic-pathways.html" (dict
  "page" .
  "showAll" true
  "headline" $home.pathways_title
  "copy" $home.pathways_copy
) }}

<!-- FEATURED BANNER -->
<div class="featured-banner reveal">
  <div class="featured-inner">
    <div class="featured-text">
      <h2>{{ $home.featured_title }}</h2>
      <p>{{ $home.featured_copy }}</p>
    </div>
    <a href="{{ $home.featured_link_url }}" class="btn-amber">{{ $home.featured_link_label }}</a>
  </div>
</div>

{{ end }}
